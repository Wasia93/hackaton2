# Todo API Backend

**Phase II - Full-Stack Web Application Backend**

FastAPI backend with SQLModel, PostgreSQL, and JWT authentication.

---

## Tech Stack

- **Framework**: FastAPI 0.115+
- **ORM**: SQLModel 0.0.22
- **Database**: PostgreSQL (Neon Serverless)
- **Authentication**: JWT tokens (shared with Better Auth frontend)
- **Migrations**: Alembic
- **Password Hashing**: Passlib with bcrypt

---

## Project Structure

```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py                 # FastAPI app entry point
│   ├── models/                 # SQLModel database models
│   │   ├── user.py            # User model
│   │   ├── better_auth_user.py # Better Auth user model
│   │   └── task.py            # Task model
│   ├── services/               # Business logic layer
│   │   └── task_service.py    # Task CRUD operations
│   ├── api/                    # API endpoints
│   │   └── tasks.py           # Task routes
│   └── core/                   # Core utilities
│       ├── config.py          # Settings and configuration
│       ├── database.py        # Database connection
│       ├── security.py        # JWT and password utilities
│       └── auth.py            # Authentication middleware
├── requirements.txt            # Python dependencies
└── .env.example               # Environment variables template
```

---

## Setup Instructions

### 1. Create Virtual Environment

```bash
cd backend
python -m venv venv

# Windows
venv\Scripts\activate

# Mac/Linux
source venv/bin/activate
```

### 2. Install Dependencies

```bash
pip install -r requirements.txt
```

### 3. Set Up Neon PostgreSQL Database

1. Go to [Neon](https://neon.tech/) and create a free account
2. Create a new project
3. Copy the connection string

### 4. Configure Environment Variables

```bash
cp .env.example .env
```

Edit `.env` and add your database URL:

```env
DATABASE_URL=postgresql://user:password@your-neon-host.neon.tech/neondb
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
CORS_ORIGINS=http://localhost:3000
```

### 5. Run Database Migrations

```bash
# Initialize Alembic (if not done yet)
alembic init alembic

# Create initial migration
alembic revision --autogenerate -m "Initial schema"

# Apply migrations
alembic upgrade head
```

### 6. Run Development Server

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

API will be available at: `http://localhost:8000`

---

## API Documentation

Once the server is running, visit:

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

---

## API Endpoints

### System Endpoints

- `GET /` - Root endpoint with API info
- `GET /health` - Health check

### Task Endpoints (Authenticated)

All task endpoints require JWT token in `Authorization: Bearer <token>` header.

- `POST /tasks/` - Create new task
- `GET /tasks/` - Get all tasks for current user
- `GET /tasks/{id}` - Get specific task
- `PUT /tasks/{id}` - Update task
- `DELETE /tasks/{id}` - Delete task
- `PATCH /tasks/{id}/toggle` - Toggle completion status

---

## Authentication

The backend expects JWT tokens generated by Better Auth on the frontend.

**Token Format**:
```json
{
  "sub": "user-id-uuid",
  "exp": 1234567890
}
```

**Header Format**:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## Data Isolation

All task operations are automatically filtered by `user_id` extracted from the JWT token.

Users can only:
- Create tasks for themselves
- View their own tasks
- Update their own tasks
- Delete their own tasks

Attempting to access another user's task returns 404.

---

## Development

### Running Tests

```bash
pytest backend/tests/
```

### Code Quality

```bash
# Format code
black backend/

# Lint code
pylint backend/app/
```

---

## Deployment

### Railway / Render

1. Add `Procfile`:
```
web: uvicorn app.main:app --host 0.0.0.0 --port $PORT
```

2. Set environment variables in dashboard
3. Deploy from GitHub

---

## Tasks Implemented

- ✅ T-001: Backend directory structure
- ✅ T-002: Dependencies file
- ✅ T-003: Environment configuration
- ✅ T-004: Database connection
- ✅ T-005: User model
- ✅ T-006: Better Auth user model
- ✅ T-007: Task model
- ✅ T-010: JWT authentication utilities
- ✅ T-011: Authentication middleware
- ✅ T-012: Task service layer
- ✅ T-013: Task API endpoints
- ✅ T-014: FastAPI application

---

## Next Steps

- [ ] T-008: Alembic configuration
- [ ] T-009: Database migrations
- [ ] T-015: Backend tests
- [ ] Connect with Next.js frontend
- [ ] Deploy to production

---

**Generated with Spec-Driven Development**
**Claude Code + SpecKit Plus**
